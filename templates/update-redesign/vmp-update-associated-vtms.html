{% extends "update-redesign/base2.html" %}
{% block content %}


<div class="nhsuk-grid-row">
    <div id="content-pane" class="nhsuk-grid-column-full">

           <div class="nhsuk-grid-column-three-quarters">
        <span class="nhsuk-caption-l" id="update-associated-vtm-sub-heading">Update associated VTM</span>
        <span class="nhsuk-u-visually-hidden"> - </span>
        <h1 class="nhsuk-heading-xl" id="update-associated-vtm-heading">Abacavir 20mg/ml oral solution sugar free</h1>
</div>
        
  <div class="nhsuk-grid-column-one-quarter" style="float: right;">
                <button class="nhsuk-button nhsuk-button--secondary-solid nhsuk-button-float-right"
                    data-module="nhsuk-button" type="submit">
                    Cancel update
                </button>
            </div>


        <form method="post">
            <input name="_csrf"
                value="QoCvWnwUOzczknFXPdKztAgCRnbecl-sn98n-KoiLZZSkyTke-PNbE5xDg8eoUNuDf-H0Txna066Rm-Br74VnZwaG_BqoUeH"
                type="hidden">




            <section id="vtm-0">

                <div class="nhsuk-grid-column-full update-box">
                      <div class="update-general-heading">
                                <h2 class="nhsuk-heading-l nhsuk-u-margin-bottom-1">Abacavir</h2>
                                <a href="#" class="nhsuk-link nhsuk-link--reverse nhsuk-button-float-right">Revert
                                    changes</a>


                            </div>

                    <!--Current name-->
                    <fieldset class="nhsuk-fieldset">
                      
                        <input class="nhsuk-input" type="hidden" id="values0.id" name="values[0].id" value="15">
                        <input class="nhsuk-input" type="hidden" id="values0.name" name="values[0].name"
                            value="Abacavir">

                        <!--Start Date-->
                        <div class="nhsuk-grid-column-one-third">
                            <div class="nhsuk-form-group">
                                <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m"
                                    id="vtm-0-start-date-legend">
                                    Start date
                                </legend>


                                <div class="nhsuk-form-group">

                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div class="nhsuk-date-input" id="vtm-0-start-date">
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-start-date-day"><span
                                                        class="nhsuk-u-visually-hidden">Start date </span>Day</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2 js-paste-date"
                                                    inputmode="numeric" maxlength="2" id="vtm-0-start-date-day"
                                                    type="text" name="values[0].startDate.day" value="08">
                                            </div>
                                        </div>
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-start-date-month"><span
                                                        class="nhsuk-u-visually-hidden">Start date </span>Month</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2 js-paste-date"
                                                    inputmode="numeric" maxlength="2" id="vtm-0-start-date-month"
                                                    type="text" name="values[0].startDate.month" value="12">
                                            </div>
                                        </div>
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-start-date-year"><span
                                                        class="nhsuk-u-visually-hidden">Start date </span>Year</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-4 js-paste-date"
                                                    inputmode="numeric" maxlength="4" id="vtm-0-start-date-year"
                                                    type="text" name="values[0].startDate.year" value="2004">
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>

                        <!--End Date-->
                        <div class="nhsuk-grid-column-one-third">
                            <div class="nhsuk-form-group">
                                <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m"
                                    id="vtm-0-end-date-heading">
                                    End date
                                </legend>


                                <div class="nhsuk-form-group">

                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div>

                                    </div>
                                    <div class="nhsuk-date-input" id="vtm-0-end-date">
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-end-date-day"><span class="nhsuk-u-visually-hidden">End
                                                        date </span>Day</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2 js-paste-date"
                                                    inputmode="numeric" maxlength="2" id="vtm-0-end-date-day"
                                                    type="text" name="values[0].endDate.day" value="01">
                                            </div>
                                        </div>
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-end-date-month"><span class="nhsuk-u-visually-hidden">End
                                                        date </span>Month</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-2 js-paste-date"
                                                    inputmode="numeric" maxlength="2" id="vtm-0-end-date-month"
                                                    type="text" name="values[0].endDate.month" value="02">
                                            </div>
                                        </div>
                                        <div class="nhsuk-date-input__item">
                                            <div class="nhsuk-form-group">
                                                <label class="nhsuk-label nhsuk-date-input__label"
                                                    for="vtm-0-end-date-year"><span class="nhsuk-u-visually-hidden">End
                                                        date </span>Year</label>
                                                <input
                                                    class="nhsuk-input nhsuk-date-input__input nhsuk-input--width-4 js-paste-date"
                                                    inputmode="numeric" maxlength="4" id="vtm-0-end-date-year"
                                                    type="text" name="values[0].endDate.year" value="3456">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <button class="nhsuk-button nhsuk-button--reverse" type="button"
                                onclick="setLastDayOfPreviousMonth(this)">
                                End Attribute
                            </button>
                        </div>

                        <div class="nhsuk-grid-column-full">
                            <legend id="vtm-0-add-heading" class="nhsuk-fieldset__legend--m nhsuk-u-visually-hidden">
                                Action
                            </legend>
                            <div class="action-update">
                                <button id="update-vtm-0" type="submit" name="_eventId_updateVtm"
                                    value="310cc91f-bd01-4621-814c-93c23d073d6f"
                                    class="nhsuk-button nhsuk-button--secondary">Change associated VTM</button>
                            </div>
                        </div>

                    </fieldset>

                </div>

            </section>



            <button class="nhsuk-button nhsuk-button--primary" id="submit" name="_eventId_submit" type="submit">Preview changes
            </button>

        </form>
    </div>
</div>

<script>
    function setLastDayOfPreviousMonth(button) {
        // Find the nearest parent with class "nhsuk-date-input"
        const dateContainer = button.closest('.nhsuk-grid-column-one-third')
            ?.querySelector('.nhsuk-date-input');

        if (!dateContainer) return;

        const dayInput = dateContainer.querySelector('input[id$="-day"]');
        const monthInput = dateContainer.querySelector('input[id$="-month"]');
        const yearInput = dateContainer.querySelector('input[id$="-year"]');

        if (!dayInput || !monthInput || !yearInput) return;

        // Calculate yesterday's date instead of last day of previous month
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(today.getDate() - 1);

        // Pad values for consistency
        const day = String(yesterday.getDate()).padStart(2, '0');
        const month = String(yesterday.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
        const year = yesterday.getFullYear();

        // Set values
        dayInput.value = day;
        monthInput.value = month;
        yearInput.value = year;
    }
</script>
{% endblock %}